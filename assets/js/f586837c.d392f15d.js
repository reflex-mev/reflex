"use strict";(self.webpackChunkreflex_docs=self.webpackChunkreflex_docs||[]).push([[9951],{2926:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>x,frontMatter:()=>t,metadata:()=>o,toc:()=>a});var i=r(4848),s=r(8453);const t={sidebar_position:2},l="ReflexAfterSwap",o={id:"api/reflex-after-swap",title:"ReflexAfterSwap",description:"Abstract base contract for DEX plugin integration with failsafe mechanisms.",source:"@site/docs/api/reflex-after-swap.md",sourceDirName:"api",slug:"/api/reflex-after-swap",permalink:"/api/reflex-after-swap",draft:!1,unlisted:!1,editUrl:"https://github.com/reflex-mev/reflex/tree/main/website/docs/api/reflex-after-swap.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"ReflexRouter",permalink:"/api/reflex-router"},next:{title:"BackrunEnabledSwapProxy",permalink:"/api/backrun-enabled-swap-proxy"}},d={},a=[{value:"Constructor",id:"constructor",level:2},{value:"State Variables",id:"state-variables",level:2},{value:"Administrative Functions",id:"administrative-functions",level:2},{value:"setReflexRouter",id:"setreflexrouter",level:3},{value:"setReflexConfigId",id:"setreflexconfigid",level:3},{value:"View Functions",id:"view-functions",level:2},{value:"getRouter",id:"getrouter",level:3},{value:"getReflexAdmin",id:"getreflexadmin",level:3},{value:"getConfigId",id:"getconfigid",level:3},{value:"Internal Functions",id:"internal-functions",level:2},{value:"_reflexAfterSwap",id:"_reflexafterswap",level:3},{value:"Modifiers",id:"modifiers",level:2},{value:"onlyReflexAdmin",id:"onlyreflexadmin",level:3},{value:"Implementation Example",id:"implementation-example",level:2},{value:"Error Messages",id:"error-messages",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"reflexafterswap",children:"ReflexAfterSwap"})}),"\n",(0,i.jsx)(n.p,{children:"Abstract base contract for DEX plugin integration with failsafe mechanisms."}),"\n",(0,i.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"constructor(address _router, bytes32 _configId)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_router"})," - Address of the ReflexRouter contract"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_configId"})," - Configuration ID for profit distribution"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Router address must be non-zero"}),"\n",(0,i.jsx)(n.li,{children:"Fetches admin address from the router contract"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"state-variables",children:"State Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"address reflexRouter;      // Address of the Reflex router contract\naddress reflexAdmin;       // Address of the reflex admin (authorized controller)\nbytes32 reflexConfigId;    // Configuration ID for profit distribution\n"})}),"\n",(0,i.jsx)(n.h2,{id:"administrative-functions",children:"Administrative Functions"}),"\n",(0,i.jsx)(n.h3,{id:"setreflexrouter",children:"setReflexRouter"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"function setReflexRouter(address _router) external onlyReflexAdmin\n"})}),"\n",(0,i.jsx)(n.p,{children:"Updates the Reflex router address and refreshes admin."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_router"})," - New router address to set"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Access:"})," Reflex admin only"]}),"\n",(0,i.jsx)(n.h3,{id:"setreflexconfigid",children:"setReflexConfigId"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"function setReflexConfigId(bytes32 _configId) external onlyReflexAdmin\n"})}),"\n",(0,i.jsx)(n.p,{children:"Updates the configuration ID for profit distribution."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_configId"})," - New configuration ID to set"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Access:"})," Reflex admin only"]}),"\n",(0,i.jsx)(n.h2,{id:"view-functions",children:"View Functions"}),"\n",(0,i.jsx)(n.h3,{id:"getrouter",children:"getRouter"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"function getRouter() public view returns (address)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Returns the current router address."}),"\n",(0,i.jsx)(n.h3,{id:"getreflexadmin",children:"getReflexAdmin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"function getReflexAdmin() external view returns (address)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Returns the current reflex admin address."}),"\n",(0,i.jsx)(n.h3,{id:"getconfigid",children:"getConfigId"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"function getConfigId() external view returns (bytes32)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Returns the current configuration ID for profit distribution."}),"\n",(0,i.jsx)(n.h2,{id:"internal-functions",children:"Internal Functions"}),"\n",(0,i.jsx)(n.h3,{id:"_reflexafterswap",children:"_reflexAfterSwap"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"function _reflexAfterSwap(\n    bytes32 triggerPoolId,\n    int256 amount0Delta,\n    int256 amount1Delta,\n    bool zeroForOne,\n    address recipient\n) internal gracefulNonReentrant returns (uint256 profit, address profitToken)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Main entry point for post-swap profit extraction via backrunning."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"triggerPoolId"})," - Unique identifier for the pool that triggered the swap"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"amount0Delta"})," - The change in token0 balance from the original swap"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"amount1Delta"})," - The change in token1 balance from the original swap"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"zeroForOne"})," - Direction of the original swap (true if token0 \u2192 token1)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"recipient"})," - Address that should receive the extracted profits"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"profit"})," - Amount of profit extracted (0 if router call fails)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"profitToken"})," - Address of the token in which profit was extracted (address(0) if failed)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Features:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Failsafe operation with try-catch mechanism"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Router failures won't break main swap operations"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Reentrancy protection via graceful reentrancy guard"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Automatic profit distribution using configured settings"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"modifiers",children:"Modifiers"}),"\n",(0,i.jsx)(n.h3,{id:"onlyreflexadmin",children:"onlyReflexAdmin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:'modifier onlyReflexAdmin() {\n    require(msg.sender == reflexAdmin, "Caller is not the reflex admin");\n    _;\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Restricts access to reflex admin only."}),"\n",(0,i.jsx)(n.h2,{id:"implementation-example",children:"Implementation Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:'pragma solidity ^0.8.20;\n\nimport "@reflex/contracts/base/ReflexAfterSwap.sol";\n\ncontract AlgebraPlugin is ReflexAfterSwap {\n    address public immutable pool;\n\n    constructor(\n        address _reflexRouter,\n        address _pool,\n        bytes32 _configId\n    ) ReflexAfterSwap(_reflexRouter, _configId) {\n        pool = _pool;\n    }\n\n    modifier onlyPool() {\n        require(msg.sender == pool, "Only pool can call");\n        _;\n    }\n\n    function afterSwap(\n        address,\n        address,\n        bool zeroForOne,\n        int256 amount0Delta,\n        int256 amount1Delta,\n        uint160,\n        uint128,\n        int24,\n        bytes calldata hookData\n    ) external override onlyPool returns (bytes4) {\n        // Extract recipient from hook data\n        address recipient = abi.decode(hookData, (address));\n\n        // Trigger backrun using base contract\'s internal function\n        _reflexAfterSwap(\n            bytes32(uint256(uint160(pool))),\n            amount0Delta,\n            amount1Delta,\n            zeroForOne,\n            recipient\n        );\n\n        return this.afterSwap.selector;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"error-messages",children:"Error Messages"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"Invalid router address"'})," - Router address is zero in constructor or setReflexRouter"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"Caller is not the reflex admin"'})," - Access control for admin-only functions"]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);