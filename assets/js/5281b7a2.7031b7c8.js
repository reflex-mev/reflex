"use strict";(self.webpackChunkreflex_docs=self.webpackChunkreflex_docs||[]).push([[443],{8798:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var n=i(4848),r=i(8453);const s={sidebar_position:1},a="Architecture",o={id:"architecture",title:"Architecture",description:"Understanding Reflex's architecture is key to building effective MEV capture strategies. This document provides a comprehensive overview of the system design, components, and data flow.",source:"@site/docs/architecture.md",sourceDirName:".",slug:"/architecture",permalink:"/reflex/architecture",draft:!1,unlisted:!1,editUrl:"https://github.com/reflex-mev/reflex/tree/main/website/docs/architecture.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/reflex/"},next:{title:"Integration Overview",permalink:"/reflex/integration/overview"}},c={},l=[{value:"\ud83c\udfd7\ufe0f High-Level Architecture",id:"\ufe0f-high-level-architecture",level:2},{value:"Core Components Per Chain",id:"core-components-per-chain",level:3},{value:"\ud83e\udde9 Core Components",id:"-core-components",level:2},{value:"1. Reflex Router",id:"1-reflex-router",level:3},{value:"2. Reflex Quoter",id:"2-reflex-quoter",level:3},{value:"3. Integration Types",id:"3-integration-types",level:3},{value:"SDK Application Types:",id:"sdk-application-types",level:4},{value:"SDK Capabilities:",id:"sdk-capabilities",level:4},{value:"\ud83d\udd04 Transaction Flow",id:"-transaction-flow",level:2},{value:"Standard Backrun Flow",id:"standard-backrun-flow",level:3},{value:"\ud83d\udca1 Capabilities",id:"-capabilities",level:2},{value:"1. Sandwich Attack Prevention",id:"1-sandwich-attack-prevention",level:3},{value:"2. Slippage Correction",id:"2-slippage-correction",level:3},{value:"\ud83d\udee1\ufe0f Security Architecture",id:"\ufe0f-security-architecture",level:2},{value:"Reflex Security",id:"reflex-security",level:3},{value:"Risk Mitigation",id:"risk-mitigation",level:3},{value:"\ud83d\udd27 Gas Optimization",id:"-gas-optimization",level:2},{value:"Efficient Profit Detection",id:"efficient-profit-detection",level:3},{value:"Gas Economics",id:"gas-economics",level:3},{value:"Gas Limit Recommendations",id:"gas-limit-recommendations",level:3},{value:"\ud83c\udf10 Multi-Chain Architecture",id:"-multi-chain-architecture",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,n.jsx)(t.p,{children:"Understanding Reflex's architecture is key to building effective MEV capture strategies. This document provides a comprehensive overview of the system design, components, and data flow."}),"\n",(0,n.jsx)(t.h2,{id:"\ufe0f-high-level-architecture",children:"\ud83c\udfd7\ufe0f High-Level Architecture"}),"\n",(0,n.jsx)(t.p,{children:"Reflex operates through a simple yet powerful architecture consisting of core smart contracts deployed per chain and multiple integration pathways for different entities. The system is designed to capture MEV opportunities and distribute profits fairly across the ecosystem."}),"\n",(0,n.jsx)(t.h3,{id:"core-components-per-chain",children:"Core Components Per Chain"}),"\n",(0,n.jsx)(t.p,{children:"Each blockchain network has two core Reflex contracts:"}),"\n",(0,n.jsx)(t.mermaid,{value:'graph LR\n    subgraph "Users"\n        UserGroup[\ud83d\udc64 Users<br/>Traders & DeFi Users]\n    end\n\n    subgraph "Core Smart Contracts (Per Chain)"\n        Router[\u26a1 Reflex Router<br/>Execution engine]\n        Quoter[\ud83e\udde0 Reflex Quoter<br/>Profit detection & path optimization]\n        Router <--\x3e Quoter\n    end\n\n    subgraph "Onchain Clients"\n        PluginDEX[\ud83d\udd0c Plugin-based DEX<br/>Automatic MEV capture via hooks]\n        RegularDEX[\ud83c\udfea Standard DEX<br/>Direct router integration]\n    end\n\n    subgraph "Offchain Clients"\n        SDKApps[\ud83d\udcf1 SDK Applications<br/>DApps, MEV Bots]\n    end\n\n    %% User transactions trigger MEV opportunities\n    UserGroup --\x3e|Trade/Swap| PluginDEX\n    UserGroup --\x3e|Trade/Swap| RegularDEX\n    UserGroup --\x3e|Interact| SDKApps\n\n    %% Client connections to core contracts\n    PluginDEX --\x3e|triggerBackrun| Router\n    RegularDEX --\x3e|triggerBackrun| Router\n    SDKApps --\x3e|backrunedExecute| Router'}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Reflex Router"})," - The central execution engine that coordinates all MEV capture activities. Handles both automatic MEV capture through ",(0,n.jsx)(t.code,{children:"triggerBackrun()"})," and protected transaction execution through ",(0,n.jsx)(t.code,{children:"backrunedExecute()"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Reflex Quoter"})," - The analysis engine that detects MEV opportunities by analyzing price differences across DEX pools, calculating optimal arbitrage routes, and estimating profitability."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Onchain Clients"})," - Smart contracts that integrate directly with Reflex:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Plugin-based DEXes use hooks to automatically capture MEV after user swaps"}),"\n",(0,n.jsx)(t.li,{children:"Standard DEXes integrate the router directly into their core contracts"}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Offchain Clients"})," - Applications that use the Reflex SDK:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"DApps protect users from MEV while capturing profits"}),"\n",(0,n.jsx)(t.li,{children:"MEV Bots implement custom strategies for professional MEV extraction"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"-core-components",children:"\ud83e\udde9 Core Components"}),"\n",(0,n.jsx)(t.h3,{id:"1-reflex-router",children:"1. Reflex Router"}),"\n",(0,n.jsxs)(t.p,{children:["The central execution engine that coordinates all MEV capture activities. ",(0,n.jsx)(t.strong,{children:"One instance deployed per blockchain."})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Key Responsibilities:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Executes MEV capture through two main entry points"}),"\n",(0,n.jsx)(t.li,{children:"Coordinates with the quoter for profitability analysis"}),"\n",(0,n.jsx)(t.li,{children:"Manages arbitrage execution for MEV capture"}),"\n",(0,n.jsx)(t.li,{children:"Handles revenue distribution to configured recipients"}),"\n",(0,n.jsx)(t.li,{children:"Maintains security through reentrancy protection"}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"2-reflex-quoter",children:"2. Reflex Quoter"}),"\n",(0,n.jsxs)(t.p,{children:["The pricing and analysis engine that determines MEV opportunities. ",(0,n.jsx)(t.strong,{children:"One instance deployed per blockchain."})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Key Responsibilities:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Analyzes price differences across DEX pools in real-time"}),"\n",(0,n.jsx)(t.li,{children:"Calculates optimal arbitrage routes and execution paths"}),"\n",(0,n.jsx)(t.li,{children:"Estimates gas costs and net profitability"}),"\n",(0,n.jsx)(t.li,{children:"Provides execution parameters to the router"}),"\n",(0,n.jsx)(t.li,{children:"Caches route data for efficiency"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Analysis Workflow:"})}),"\n",(0,n.jsx)(t.mermaid,{value:"graph LR\n    TriggerPool[\ud83c\udfaf Trigger] --\x3e PriceCheck[\ud83d\udcca Analysis]\n    PriceCheck --\x3e RouteFind[\ud83d\udee3\ufe0f Route Discovery]\n    RouteFind --\x3e GasEst[\u26fd Gas Estimation]\n    GasEst --\x3e ProfitCalc[\ud83d\udcb0 Profit Calculation]\n    ProfitCalc --\x3e ExecutionPlan[\u26a1 Execution Parameters]"}),"\n",(0,n.jsx)(t.h3,{id:"3-integration-types",children:"3. Integration Types"}),"\n",(0,n.jsx)(t.p,{children:"Reflex supports three main integration patterns to accommodate different use cases:"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Plugin-based Integration"})," - Lightweight contracts that use DEX hooks or callbacks to automatically trigger MEV capture after user swaps. Ideal for existing DEX protocols that want to add MEV capture without modifying core contracts."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Direct Integration"})," - DEX protocols integrate Reflex router calls directly into their core smart contracts. Provides maximum control and customization for revenue sharing and MEV strategies."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"SDK Integration"})," - Applications use the TypeScript SDK to interact with Reflex. Perfect for DApp frontends, MEV bots, trading tools, and any offchain application that wants to protect users or implement custom MEV strategies."]}),"\n",(0,n.jsx)(t.h4,{id:"sdk-application-types",children:"SDK Application Types:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"DApp Frontends"}),": Protect users from MEV while capturing profits"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"MEV Bots"}),": Custom strategies for professional MEV extraction"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Protocol UIs"}),": Integrated MEV capture in protocol interfaces"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Trading Tools"}),": Enhanced trading with automatic MEV protection"]}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"sdk-capabilities",children:"SDK Capabilities:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Event monitoring and opportunity detection"}),"\n",(0,n.jsx)(t.li,{children:"Transaction simulation and profit estimation"}),"\n",(0,n.jsx)(t.li,{children:"Automated MEV capture execution"}),"\n",(0,n.jsx)(t.li,{children:"Multi-chain deployment management"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"-transaction-flow",children:"\ud83d\udd04 Transaction Flow"}),"\n",(0,n.jsx)(t.h3,{id:"standard-backrun-flow",children:"Standard Backrun Flow"}),"\n",(0,n.jsx)(t.mermaid,{value:"sequenceDiagram\n    participant User\n    participant Integration as Reflex Integration<br/>(Plugin/SDK/Direct)\n    participant Router as Reflex Router\n    participant Quoter as Reflex Quoter\n\n    User->>Integration: Execute Swap\n    Integration->>Integration: Execute user swap\n    Integration->>Router: triggerBackrun()\n    Router->>Quoter: getQuote()\n    Quoter--\x3e>Router: profit estimate + route\n\n    alt Profitable Opportunity\n        Router->>Router: Execute arbitrage route\n        Router->>Router: Distribute profits to user & protocol\n    end"}),"\n",(0,n.jsx)(t.h2,{id:"-capabilities",children:"\ud83d\udca1 Capabilities"}),"\n",(0,n.jsx)(t.h3,{id:"1-sandwich-attack-prevention",children:"1. Sandwich Attack Prevention"}),"\n",(0,n.jsx)(t.p,{children:"Transform harmful sandwich attacks into beneficial backruns:"}),"\n",(0,n.jsx)(t.mermaid,{value:"graph LR\n    BadMEV[\ud83d\ude08 Sandwich Attack] --\x3e Detection[\ud83d\udd0d Detection]\n    Detection --\x3e Mitigation[\ud83d\udee1\ufe0f Mitigation]\n    Mitigation --\x3e GoodMEV[\ud83d\ude07 User Backrun]\n    GoodMEV --\x3e Reward[\ud83c\udf81 User Rewards]"}),"\n",(0,n.jsx)(t.h3,{id:"2-slippage-correction",children:"2. Slippage Correction"}),"\n",(0,n.jsx)(t.p,{children:"Detect and correct price slippage by capturing arbitrage opportunities:"}),"\n",(0,n.jsx)(t.mermaid,{value:"graph LR\n    UserSwap[User Swap] --\x3e PriceImpact[Price Impact Created]\n    PriceImpact --\x3e Detection[Slippage Detection]\n    Detection --\x3e Correction[Arbitrage Execution]\n    Correction --\x3e Profit[Captured Profit]\n    Profit --\x3e UserShare[Shared with User]"}),"\n",(0,n.jsx)(t.h2,{id:"\ufe0f-security-architecture",children:"\ud83d\udee1\ufe0f Security Architecture"}),"\n",(0,n.jsx)(t.h3,{id:"reflex-security",children:"Reflex Security"}),"\n",(0,n.jsx)(t.p,{children:"Reflex implements multiple security layers to ensure safe and reliable MEV operations:"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Failsafe Mechanisms"})," - Built-in safety checks that prevent execution if profitability thresholds aren't met or if gas costs exceed expected limits. All operations can be safely reverted without affecting user transactions."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Independent Operation"})," - Reflex operates completely independently from protocol and user swaps. The system has no access to user funds or protocol treasuries, only capturing MEV through legitimate arbitrage opportunities."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Reentrancy Protection"})," - All router functions implement strict reentrancy guards to prevent malicious contracts from exploiting callback mechanisms during MEV executions."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Access Controls"})," - Granular permission system ensures only authorized contracts can trigger specific functions, with different access levels for plugins, direct integrations, and administrative operations."]}),"\n",(0,n.jsx)(t.h3,{id:"risk-mitigation",children:"Risk Mitigation"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Reentrancy Protection"}),": Protected by reentrancy guards and callback validation"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Unauthorized Access"}),": Role-based permissions prevent malicious contract interactions"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Fund Safety"}),": No direct access to user or protocol funds - only captures public arbitrage opportunities"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Execution Failures"}),": Comprehensive failsafe mechanisms ensure failed MEV attempts don't impact user transactions"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"-gas-optimization",children:"\ud83d\udd27 Gas Optimization"}),"\n",(0,n.jsx)(t.h3,{id:"efficient-profit-detection",children:"Efficient Profit Detection"}),"\n",(0,n.jsx)(t.p,{children:"Reflex implements a multi-stage gas optimization strategy that minimizes costs while maximizing MEV capture efficiency:"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Stage 1: Profit Check (Minimal Gas)"})," - Initial profitability assessment adds virtually no gas overhead. This lightweight check determines if an MEV opportunity exists without committing to expensive calculations."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Stage 2: Route Optimization (Moderate Gas)"})," - When profitable opportunities are detected, the system performs detailed route calculations and profit estimations. This includes optimal path discovery, gas cost analysis, and net profit calculations."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Stage 3: Swap Execution (Variable Gas)"})," - Actual MEV capture execution with gas costs dependent on the selected arbitrage route. Multi-hop swaps require additional gas per DEX interaction."]}),"\n",(0,n.jsx)(t.h3,{id:"gas-economics",children:"Gas Economics"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Profitability Guarantee"})," - All executed backruns are profitable by design, ensuring gas costs are always covered by captured MEV profits. Failed profitability checks prevent unprofitable executions."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"User Gas Rebates"})," - A portion of captured MEV profits is automatically shared with users to offset their original transaction gas costs, providing net positive value."]}),"\n",(0,n.jsx)(t.h3,{id:"gas-limit-recommendations",children:"Gas Limit Recommendations"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Recommended Gas Limit"})," - For optimal MEV capture, we recommend setting a gas limit of 1.5M gas for most transactions, this provides sufficient headroom for profitable MEV operations."]}),"\n",(0,n.jsx)(t.h2,{id:"-multi-chain-architecture",children:"\ud83c\udf10 Multi-Chain Architecture"}),"\n",(0,n.jsx)(t.p,{children:"Reflex is designed to work across multiple blockchain networks and supported by over 180 EVM chains."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.p,{children:"This architecture enables Reflex to provide efficient, secure, and fair MEV capture that benefits all participants in the DeFi ecosystem. The modular design allows for easy integration with existing protocols while maintaining the flexibility to adapt to future innovations."}),"\n",(0,n.jsxs)(t.p,{children:["For implementation details, see our ",(0,n.jsx)(t.a,{href:"./integration/overview",children:"Integration Guide"})," and ",(0,n.jsx)(t.a,{href:"./api/smart-contracts",children:"API Reference"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}}}]);